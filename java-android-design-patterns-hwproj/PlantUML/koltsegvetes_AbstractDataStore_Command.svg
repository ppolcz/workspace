<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="2078pt" style="width:2192px;height:2078px;" version="1.1" viewBox="0 0 2192 2078" width="2192pt"><defs><filter height="300%" id="f1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><polygon fill="#FFFFFF" filter="url(#f1)" points="22,534,121,534,128,556.2969,1587,556.2969,1587,1575,22,1575,22,534" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="22" x2="128" y1="556.2969" y2="556.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="25" y="549.9951">CoreLibrary</text><polygon fill="#FFFFFF" filter="url(#f1)" points="46,578,170,578,177,600.2969,1563,600.2969,1563,1551,46,1551,46,578" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="46" x2="177" y1="600.2969" y2="600.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="49" y="593.9951">CoreLibrary.db</text><polygon fill="#FFFFFF" filter="url(#f1)" points="302,688,500,688,507,710.2969,746,710.2969,746,1101,302,1101,302,688" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="302" x2="507" y1="710.2969" y2="710.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="305" y="703.9951">CoreLibrary.db.listeners</text><rect fill="#FEFECE" filter="url(#f1)" height="244.0703" style="stroke: #A80036; stroke-width: 1.5;" width="422" x="1102" y="636"/><ellipse cx="1250.75" cy="652" fill="#A9DCDF" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1250.8594,647.3438 L1249.7031,652.4219 L1252.0313,652.4219 L1250.8594,647.3438 Z M1249.375,645.1094 L1252.3594,645.1094 L1255.7188,657.5 L1253.2656,657.5 L1252.5,654.4375 L1249.2188,654.4375 L1248.4688,657.5 L1246.0313,657.5 L1249.375,645.1094 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="116" x="1271.25" y="656.1543">AbstractDataStore</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1103" x2="1523" y1="668" y2="668"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1110" y="676.9023"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="1122" y="682.2104">helper : ISQLiteHelper</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1110" y="689.707"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="171" x="1122" y="695.0151">commands : List&lt;Command&gt;</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1110" y="702.5117"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="218" x="1122" y="707.8198">actualState : List&lt;Command&gt;.Iterator</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1103" x2="1523" y1="714.4141" y2="714.4141"/><ellipse cx="1113" cy="726.3164" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="207" x="1122" y="728.6245">acceptCommand(Command) : Query</text><ellipse cx="1113" cy="739.1211" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="1122" y="741.4292">undo() : bool</text><ellipse cx="1113" cy="751.9258" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="70" x="1122" y="754.2339">redo() : bool</text><ellipse cx="1113" cy="764.7305" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="86" x="1122" y="767.0386">resetRedoList()</text><ellipse cx="1113" cy="794.3398" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="308" x="1122" y="796.6479">sqlInsert(EColumnNames[] cols, Object[] vals) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1430" y1="798.6479" y2="798.6479"/><ellipse cx="1113" cy="807.1445" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="307" x="1122" y="809.4526">sqlRemove(ETableNames table, String where) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1429" y1="811.4526" y2="811.4526"/><ellipse cx="1113" cy="819.9492" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="396" x="1122" y="822.2573">sqlUpdate(String where, EColumnNames[] cols, Object[] vals) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1518" y1="824.2573" y2="824.2573"/><ellipse cx="1113" cy="832.7539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="216" x="1122" y="835.062">sqlSelect(ETableNames table) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1338" y1="837.062" y2="837.062"/><ellipse cx="1113" cy="845.5586" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="297" x="1122" y="847.8667">sqlSelect(ETableNames table, String where) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1419" y1="849.8667" y2="849.8667"/><ellipse cx="1113" cy="858.3633" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="231" x="1122" y="860.6714">sqlSelect(EColumnNames[] cols) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1353" y1="862.6714" y2="862.6714"/><ellipse cx="1113" cy="871.168" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="312" x="1122" y="873.4761">sqlSelect(String where, EColumnNames[] cols) : String</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1122" x2="1434" y1="875.4761" y2="875.4761"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1103" x2="1219.5" y1="780.0352" y2="780.0352"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="187" x="1219.5" y="783.3433">static SQL statement generators</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1406.5" x2="1523" y1="780.0352" y2="780.0352"/><rect fill="#FEFECE" filter="url(#f1)" height="32" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="194" y="1043"/><ellipse cx="209" cy="1059" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M211.9688,1064.6406 Q211.3906,1064.9375 210.75,1065.0859 Q210.1094,1065.2344 209.4063,1065.2344 Q206.9063,1065.2344 205.5859,1063.5859 Q204.2656,1061.9375 204.2656,1058.8125 Q204.2656,1055.6875 205.5859,1054.0313 Q206.9063,1052.375 209.4063,1052.375 Q210.1094,1052.375 210.7578,1052.5313 Q211.4063,1052.6875 211.9688,1052.9844 L211.9688,1055.7031 Q211.3438,1055.125 210.75,1054.8516 Q210.1563,1054.5781 209.5313,1054.5781 Q208.1875,1054.5781 207.5,1055.6484 Q206.8125,1056.7188 206.8125,1058.8125 Q206.8125,1060.9063 207.5,1061.9766 Q208.1875,1063.0469 209.5313,1063.0469 Q210.1563,1063.0469 210.75,1062.7734 Q211.3438,1062.5 211.9688,1061.9219 L211.9688,1064.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="36" x="223" y="1063.1543">Query</text><rect fill="#FEFECE" filter="url(#f1)" height="78.4141" style="stroke: #A80036; stroke-width: 1.5;" width="373" x="1173" y="1019"/><ellipse cx="1313.25" cy="1035" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1309.1719,1030.7656 L1309.1719,1028.6094 L1316.5625,1028.6094 L1316.5625,1030.7656 L1314.0938,1030.7656 L1314.0938,1038.8438 L1316.5625,1038.8438 L1316.5625,1041 L1309.1719,1041 L1309.1719,1038.8438 L1311.6406,1038.8438 L1311.6406,1030.7656 L1309.1719,1030.7656 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="84" x="1333.75" y="1039.1543">ISQLiteHelper</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1174" x2="1545" y1="1051" y2="1051"/><ellipse cx="1184" cy="1062.9023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="204" x="1193" y="1065.2104">execSQL(String sqlcommand) : bool</text><ellipse cx="1184" cy="1075.707" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="347" x="1193" y="1078.0151">execSQL(String sqlcommand, EColumnNames[] cols) : Query</text><ellipse cx="1184" cy="1088.5117" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="122" x="1193" y="1090.8198">lastInsertRowID() : int</text><rect fill="#FEFECE" filter="url(#f1)" height="65.6094" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="920" y="724"/><ellipse cx="943.55" cy="740" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M946.5188,745.6406 Q945.9406,745.9375 945.3,746.0859 Q944.6594,746.2344 943.9563,746.2344 Q941.4563,746.2344 940.1359,744.5859 Q938.8156,742.9375 938.8156,739.8125 Q938.8156,736.6875 940.1359,735.0313 Q941.4563,733.375 943.9563,733.375 Q944.6594,733.375 945.3078,733.5313 Q945.9563,733.6875 946.5188,733.9844 L946.5188,736.7031 Q945.8938,736.125 945.3,735.8516 Q944.7063,735.5781 944.0813,735.5781 Q942.7375,735.5781 942.05,736.6484 Q941.3625,737.7188 941.3625,739.8125 Q941.3625,741.9063 942.05,742.9766 Q942.7375,744.0469 944.0813,744.0469 Q944.7063,744.0469 945.3,743.7734 Q945.8938,743.5 946.5188,742.9219 L946.5188,745.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="58" x="959.45" y="744.1543">Memento</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="921" x2="1028" y1="756" y2="756"/><ellipse cx="931" cy="767.9023" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="83" x="940" y="770.2104">before : Query</text><ellipse cx="931" cy="780.707" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="73" x="940" y="783.0151">after : Query</text><rect fill="#FEFECE" filter="url(#f1)" height="154.4375" style="stroke: #A80036; stroke-width: 1.5;" width="278" x="837" y="982"/><ellipse cx="940.75" cy="998" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M943.7188,1003.6406 Q943.1406,1003.9375 942.5,1004.0859 Q941.8594,1004.2344 941.1563,1004.2344 Q938.6563,1004.2344 937.3359,1002.5859 Q936.0156,1000.9375 936.0156,997.8125 Q936.0156,994.6875 937.3359,993.0313 Q938.6563,991.375 941.1563,991.375 Q941.8594,991.375 942.5078,991.5313 Q943.1563,991.6875 943.7188,991.9844 L943.7188,994.7031 Q943.0938,994.125 942.5,993.8516 Q941.9063,993.5781 941.2813,993.5781 Q939.9375,993.5781 939.25,994.6484 Q938.5625,995.7188 938.5625,997.8125 Q938.5625,999.9063 939.25,1000.9766 Q939.9375,1002.0469 941.2813,1002.0469 Q941.9063,1002.0469 942.5,1001.7734 Q943.0938,1001.5 943.7188,1000.9219 L943.7188,1003.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="62" x="961.25" y="1002.1543">Command</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="838" x2="1114" y1="1014" y2="1014"/><polygon fill="none" points="848,1020.9023,852,1024.9023,848,1028.9023,844,1024.9023" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="131" x="857" y="1028.2104">undoable : bool = True</text><polygon fill="none" points="848,1033.707,852,1037.707,848,1041.707,844,1037.707" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="160" x="857" y="1041.0151">sqlCommand : String[] = {}</text><text fill="#808080" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="26" x="1021" y="1041.0151">-- do</text><polygon fill="none" points="848,1046.5117,852,1050.5117,848,1054.5117,844,1050.5117" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="155" x="857" y="1053.8198">memento : Memento = null</text><text fill="#808080" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="40" x="1016" y="1053.8198">-- undo</text><polygon fill="none" points="848,1076.1211,852,1080.1211,848,1084.1211,844,1080.1211" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="168" x="857" y="1083.4292">listener : OnExecutedListener</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="838" x2="952.5" y1="1066.8164" y2="1066.8164"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="47" x="952.5" y="1070.1245">auxiliary</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="999.5" x2="1114" y1="1066.8164" y2="1066.8164"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="838" x2="1114" y1="1090.0234" y2="1090.0234"/><ellipse cx="848" cy="1101.9258" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="252" x="857" y="1104.2339">setOnExecutedListener(OnExecutedListener)</text><polygon fill="#4177AF" points="848,1110.7305,844,1116.7305,852,1116.7305" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="857" y="1117.0386">do(ISQLiteHelper) : bool</text><polygon fill="#4177AF" points="848,1123.5352,844,1129.5352,852,1129.5352" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="149" x="857" y="1129.8433">undo(ISQLiteHelper) : bool</text><rect fill="#FEFECE" filter="url(#f1)" height="73.6094" style="stroke: #A80036; stroke-width: 1.5;" width="417" x="429" y="1442"/><ellipse cx="579.25" cy="1458" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M582.2188,1463.6406 Q581.6406,1463.9375 581,1464.0859 Q580.3594,1464.2344 579.6563,1464.2344 Q577.1563,1464.2344 575.8359,1462.5859 Q574.5156,1460.9375 574.5156,1457.8125 Q574.5156,1454.6875 575.8359,1453.0313 Q577.1563,1451.375 579.6563,1451.375 Q580.3594,1451.375 581.0078,1451.5313 Q581.6563,1451.6875 582.2188,1451.9844 L582.2188,1454.7031 Q581.5938,1454.125 581,1453.8516 Q580.4063,1453.5781 579.7813,1453.5781 Q578.4375,1453.5781 577.75,1454.6484 Q577.0625,1455.7188 577.0625,1457.8125 Q577.0625,1459.9063 577.75,1460.9766 Q578.4375,1462.0469 579.7813,1462.0469 Q580.4063,1462.0469 581,1461.7734 Q581.5938,1461.5 582.2188,1460.9219 L582.2188,1463.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="599.75" y="1462.1543">UpdateCommand</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="430" x2="845" y1="1474" y2="1474"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="430" x2="845" y1="1482" y2="1482"/><ellipse cx="440" cy="1493.9023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="391" x="449" y="1496.2104">UpdateCommand(String where, EColumnNames[] cols, Object[] vals)</text><polygon fill="#4177AF" points="440,1502.707,436,1508.707,444,1508.707" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#808080" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="59" x="449" y="1509.0151">@override</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="512" y="1509.0151">do(ISQLiteHelper) : bool</text><rect fill="#FEFECE" filter="url(#f1)" height="73.6094" style="stroke: #A80036; stroke-width: 1.5;" width="304" x="880" y="1442"/><ellipse cx="972.25" cy="1458" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M975.2188,1463.6406 Q974.6406,1463.9375 974,1464.0859 Q973.3594,1464.2344 972.6563,1464.2344 Q970.1563,1464.2344 968.8359,1462.5859 Q967.5156,1460.9375 967.5156,1457.8125 Q967.5156,1454.6875 968.8359,1453.0313 Q970.1563,1451.375 972.6563,1451.375 Q973.3594,1451.375 974.0078,1451.5313 Q974.6563,1451.6875 975.2188,1451.9844 L975.2188,1454.7031 Q974.5938,1454.125 974,1453.8516 Q973.4063,1453.5781 972.7813,1453.5781 Q971.4375,1453.5781 970.75,1454.6484 Q970.0625,1455.7188 970.0625,1457.8125 Q970.0625,1459.9063 970.75,1460.9766 Q971.4375,1462.0469 972.7813,1462.0469 Q973.4063,1462.0469 974,1461.7734 Q974.5938,1461.5 975.2188,1460.9219 L975.2188,1463.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="992.75" y="1462.1543">RemoveCommand</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="881" x2="1183" y1="1474" y2="1474"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="881" x2="1183" y1="1482" y2="1482"/><ellipse cx="891" cy="1493.9023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="278" x="900" y="1496.2104">RemoveCommand(ETableNames t, String where)</text><polygon fill="#4177AF" points="891,1502.707,887,1508.707,895,1508.707" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#808080" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="59" x="900" y="1509.0151">@override</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="963" y="1509.0151">do(ISQLiteHelper) : bool</text><rect fill="#FEFECE" filter="url(#f1)" height="112.0234" style="stroke: #A80036; stroke-width: 1.5;" width="333" x="62" y="1423"/><ellipse cx="173.75" cy="1439" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M176.7188,1444.6406 Q176.1406,1444.9375 175.5,1445.0859 Q174.8594,1445.2344 174.1563,1445.2344 Q171.6563,1445.2344 170.3359,1443.5859 Q169.0156,1441.9375 169.0156,1438.8125 Q169.0156,1435.6875 170.3359,1434.0313 Q171.6563,1432.375 174.1563,1432.375 Q174.8594,1432.375 175.5078,1432.5313 Q176.1563,1432.6875 176.7188,1432.9844 L176.7188,1435.7031 Q176.0938,1435.125 175.5,1434.8516 Q174.9063,1434.5781 174.2813,1434.5781 Q172.9375,1434.5781 172.25,1435.6484 Q171.5625,1436.7188 171.5625,1438.8125 Q171.5625,1440.9063 172.25,1441.9766 Q172.9375,1443.0469 174.2813,1443.0469 Q174.9063,1443.0469 175.5,1442.7734 Q176.0938,1442.5 176.7188,1441.9219 L176.7188,1444.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="194.25" y="1443.1543">SelectCommand</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="63" x2="394" y1="1455" y2="1455"/><polygon fill="none" points="73,1461.9023,77,1465.9023,73,1469.9023,69,1465.9023" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="82" y="1469.2104">undoable : bool = False</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="63" x2="394" y1="1475.8047" y2="1475.8047"/><ellipse cx="73" cy="1487.707" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="226" x="82" y="1490.0151">SelectCommand(EColumnNames[] cols)</text><ellipse cx="73" cy="1500.5117" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="307" x="82" y="1502.8198">SelectCommand(String where, EColumnNames[] cols)</text><ellipse cx="73" cy="1513.3164" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="268" x="82" y="1515.6245">SelectCommand(ETableNames t, String where)</text><polygon fill="#4177AF" points="73,1522.1211,69,1528.1211,77,1528.1211" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#808080" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="59" x="82" y="1528.4292">@override</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="145" y="1528.4292">do(ISQLiteHelper) : bool</text><rect fill="#FEFECE" filter="url(#f1)" height="73.6094" style="stroke: #A80036; stroke-width: 1.5;" width="329" x="1219" y="1442"/><ellipse cx="1330.25" cy="1458" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1333.2188,1463.6406 Q1332.6406,1463.9375 1332,1464.0859 Q1331.3594,1464.2344 1330.6563,1464.2344 Q1328.1563,1464.2344 1326.8359,1462.5859 Q1325.5156,1460.9375 1325.5156,1457.8125 Q1325.5156,1454.6875 1326.8359,1453.0313 Q1328.1563,1451.375 1330.6563,1451.375 Q1331.3594,1451.375 1332.0078,1451.5313 Q1332.6563,1451.6875 1333.2188,1451.9844 L1333.2188,1454.7031 Q1332.5938,1454.125 1332,1453.8516 Q1331.4063,1453.5781 1330.7813,1453.5781 Q1329.4375,1453.5781 1328.75,1454.6484 Q1328.0625,1455.7188 1328.0625,1457.8125 Q1328.0625,1459.9063 1328.75,1460.9766 Q1329.4375,1462.0469 1330.7813,1462.0469 Q1331.4063,1462.0469 1332,1461.7734 Q1332.5938,1461.5 1333.2188,1460.9219 L1333.2188,1463.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="98" x="1350.75" y="1462.1543">InsertCommand</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1220" x2="1547" y1="1474" y2="1474"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1220" x2="1547" y1="1482" y2="1482"/><ellipse cx="1230" cy="1493.9023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="303" x="1239" y="1496.2104">InsertCommand(EColumnNames[] cols, Object[] vals)</text><polygon fill="#4177AF" points="1230,1502.707,1226,1508.707,1234,1508.707" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#808080" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="59" x="1239" y="1509.0151">@override</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="1302" y="1509.0151">do(ISQLiteHelper) : bool</text><rect fill="#FEFECE" filter="url(#f1)" height="65.6094" style="stroke: #A80036; stroke-width: 1.5;" width="412" x="318" y="724"/><ellipse cx="455.25" cy="740" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M451.1719,735.7656 L451.1719,733.6094 L458.5625,733.6094 L458.5625,735.7656 L456.0938,735.7656 L456.0938,743.8438 L458.5625,743.8438 L458.5625,746 L451.1719,746 L451.1719,743.8438 L453.6406,743.8438 L453.6406,735.7656 L451.1719,735.7656 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="129" x="475.75" y="744.1543">IOnExecutedListener</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="319" x2="729" y1="756" y2="756"/><ellipse cx="329" cy="767.9023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="338" y="770.2104">failure(Exception)</text><ellipse cx="329" cy="780.707" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="386" x="338" y="783.0151">undoFailure(Exception, Memento, Query failedRows, Command self)</text><rect fill="#FEFECE" filter="url(#f1)" height="52.8047" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="346" y="1031.5"/><ellipse cx="365.5" cy="1047.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M361.4219,1043.2656 L361.4219,1041.1094 L368.8125,1041.1094 L368.8125,1043.2656 L366.3438,1043.2656 L366.3438,1051.3438 L368.8125,1051.3438 L368.8125,1053.5 L361.4219,1053.5 L361.4219,1051.3438 L363.8906,1051.3438 L363.8906,1043.2656 L361.4219,1043.2656 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="122" x="380.5" y="1051.6543">IOnInsertedListener</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="347" x2="509" y1="1063.5" y2="1063.5"/><ellipse cx="357" cy="1075.4023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="138" x="366" y="1077.7104">rowIdAvailable(int rowId)</text><rect fill="#FEFECE" filter="url(#f1)" height="52.8047" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="545" y="1031.5"/><ellipse cx="560" cy="1047.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M555.9219,1043.2656 L555.9219,1041.1094 L563.3125,1041.1094 L563.3125,1043.2656 L560.8438,1043.2656 L560.8438,1051.3438 L563.3125,1051.3438 L563.3125,1053.5 L555.9219,1053.5 L555.9219,1051.3438 L558.3906,1051.3438 L558.3906,1043.2656 L555.9219,1043.2656 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="125" x="574" y="1051.6543">IOnSelectedListener</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="546" x2="701" y1="1063.5" y2="1063.5"/><ellipse cx="556" cy="1075.4023" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="124" x="565" y="1077.7104">queryAvailable(Query)</text><polygon fill="#FBFB77" filter="url(#f1)" points="355,220,355,305.6641,693,305.6641,693,230,683,220,355,220" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="355,220,355,305.6641,520,305.6641,524,723.88,528,305.6641,693,305.6641,693,230,683,220,355,220" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="683" y1="220" y2="230"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="683" y1="230" y2="230"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="361" y="237.0669">eg. print to the GUI if some failure happened.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="361" y="252.1997">In fact I try to design a model in which data loss</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="361" y="267.3325">or inconsistency cannot happen in theory, but we</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="361" y="282.4653">never know... and this type of error is fatal,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="361" y="297.5981">not easy to handle.</text><polygon fill="#FBFB77" filter="url(#f1)" points="729,155.5,729,370.2266,1217,370.2266,1217,165.5,1207,155.5,729,155.5" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="729,155.5,729,370.2266,969.218,370.2266,973.933,723.82,977.218,370.2266,1217,370.2266,1217,165.5,1207,155.5,729,155.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1207" x2="1207" y1="155.5" y2="165.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1217" x2="1207" y1="165.5" y2="165.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="449" x="735" y="172.5669">This is not a Memento in its normal sense, because this is instantiated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="735" y="187.6997">by the command, however it stores the state of the database</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="730" x2="1216" y1="190.7656" y2="190.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="735" y="206.8325">We must store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="41" x="832" y="206.8325">before</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="877" y="206.8325">and ALSO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="30" x="944" y="206.8325">after</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="978" y="206.8325">state because if we allow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="467" x="735" y="221.9653">an SQL update to modify the primary key (but not an autoincrement key)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="735" y="237.0981">than we cannot recognise which rows were affected by the update istr.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="739" y="252.231"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="735" y="267.3638">In the case of an SQL remove the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="30" x="953" y="267.3638">after</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="987" y="267.3638">state will be empty.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="739" y="282.4966"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="735" y="297.6294">In the case of an SQL insert the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="41" x="940" y="297.6294">before</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="985" y="297.6294">state will be empty.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="739" y="312.7622"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="735" y="327.895">In order to restore we just have to:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="739" y="343.0278">1. remove all rows stored in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="30" x="944" y="343.0278">after</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="739" y="358.1606">2. insert all rows stored in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="41" x="931" y="358.1606">before</text><polygon fill="#FBFB77" filter="url(#f1)" points="1603,1216.5,1603,1741.0156,2183,1741.0156,2183,1226.5,2173,1216.5,1603,1216.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2173" x2="2173" y1="1216.5" y2="1226.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2183" x2="2173" y1="1226.5" y2="1226.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1613" y="1233.5669">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="85" x="1622" y="1233.5669">sqlCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="1711" y="1233.5669">should be a single SQL instruction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1613" y="1248.6997">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="126" x="1622" y="1248.6997">sqlUndoCommands</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1752" y="1248.6997">depending on the sqlCommand can result in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="1609" y="1263.8325">multiple SQL statements, hence we approach the problem in another way:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441" x="1609" y="1278.9653">the Memento will store the rows which should be deleted, and others,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="1609" y="1294.0981">which should be inserted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1613" y="1309.231">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="85" x="1622" y="1309.231">sqlCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="1711" y="1309.231">is an empty string by default, resulting an empty</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="1609" y="1324.3638">sql statement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1613" y="1339.4966"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="1609" y="1354.6294">-- The</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1651" y="1354.6294">do</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="377" x="1673" y="1354.6294">method must be decorated and subclasses must generate</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="214" x="1609" y="1369.7622">-- the memento in it if necessary.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1609" y="1384.895">do</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1628" y="1384.895">(ISQLiteHelper helper)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1400.0278"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="320" x="1625" y="1400.0278">-- sqlCommand has to be initialized by subclasses</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1415.1606"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1625" y="1415.1606">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1674" y="1415.1606">helper.execSQL(sqlCommand)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1609" y="1430.2935">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1613" y="1445.4263"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="1609" y="1460.5591">redo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="1643" y="1460.5591">(ISQLiteHelper heler)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1475.6919"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="300" x="1625" y="1475.6919">-- memento should be initialized by subclasses</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1490.8247"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1625" y="1490.8247">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="1639" y="1490.8247">(!undoable</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="1712" y="1490.8247">or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1731" y="1490.8247">memento == null)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42" x="1855" y="1490.8247">throw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="1901" y="1490.8247">NotUndoableOrNoMemento()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="1625" y="1505.9575">Query failedRows = {}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1521.0903"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1625" y="1521.0903">for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1650" y="1521.0903">(row : memento.after)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1641" y="1536.2231"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1641" y="1536.2231">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="1655" y="1536.2231">(!helper.execSQL(toSql(delete row))) failedRows.add(row)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1551.356"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1625" y="1551.356">for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="1650" y="1551.356">(row : memento.before)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1641" y="1566.4888"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1641" y="1566.4888">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="1655" y="1566.4888">(!helper.execSQL(toSql(insert row))) failedRows.add(row)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1625" y="1581.6216"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1625" y="1581.6216">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1639" y="1581.6216">(!failure.empty) listener.undoFailure(ex, memento, failedRows, this)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1609" y="1596.7544">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1613" y="1611.8872"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="403" x="1609" y="1627.02">The create table SQL commands could be each a not undoable</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="2016" y="1627.02">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2091" y="1627.02">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="494" x="1609" y="1642.1528">We shouldn't implement a new class just for create table commands because</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="470" x="1609" y="1657.2856">these are called once in the software's life cycle (when it is first launched).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="540" x="1609" y="1672.4185">These and other initializer commands should be launched by the AbstractDataStore.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1613" y="1687.5513"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="513" x="1609" y="1702.6841">Other specialized commands during the software's life cycle (insert, remove) are</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="559" x="1609" y="1717.8169">launched by the higher level modules (eg. GUI), because these commands are given by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="509" x="1609" y="1732.9497">the user (who fills in forms and then submit the changes to AbstractDataStore).</text><polygon fill="#FBFB77" filter="url(#f1)" points="372,1893,372,1978.6641,778,1978.6641,778,1903,768,1893,372,1893" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="372,1893,372,1978.6641,778,1978.6641,778,1903,768,1893,584.874,1893,631.979,1516.011,576.874,1893,372,1893" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768" x2="768" y1="1893" y2="1903"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778" x2="768" y1="1903" y2="1903"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="382" y="1910.0669">- we assume that the primary key are constant during an</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="378" y="1925.1997">update statement (especially an autoincrement integer key)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="382" y="1940.3325">- another possibility:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="394" y="1955.4653">- remove the updated rows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="394" y="1970.5981">- insert the former rows (which are stored in a 'memento')</text><polygon fill="#FBFB77" filter="url(#f1)" points="1178,1802.5,1178,2069.7578,1699,2069.7578,1699,1812.5,1689,1802.5,1178,1802.5" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="1178,1802.5,1178,2069.7578,1699,2069.7578,1699,1812.5,1689,1802.5,1425.92,1802.5,1387.45,1516.011,1417.92,1802.5,1178,1802.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1689" x2="1689" y1="1802.5" y2="1812.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1699" x2="1689" y1="1812.5" y2="1812.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="1184" y="1819.5669">InsertCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1301" y="1819.5669">(EColumnNames[] cols, Object[] vals)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="1200" y="1834.6997">- detect table, in which we have to insert</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1200" y="1849.8325">- generate SQLite command string ==&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="85" x="1463" y="1849.8325">sqlCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1200" y="1864.9653"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="480" x="1200" y="1864.9653">we cannot generate memento object yet,  since we do not know the rowId</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1184" y="1880.0981">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1188" y="1895.231"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1184" y="1910.3638">do</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1203" y="1910.3638">(ISQLiteHelper helper)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="1200" y="1925.4966">success = super.do(helper)</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="304" x="1380" y="1925.4966">-- execute command using DataStores's helper</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1200" y="1940.6294"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1200" y="1940.6294">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="1214" y="1940.6294">(!success)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="1216" y="1955.7622">listener.failure(ex)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1216" y="1970.895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1216" y="1970.895">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1265" y="1970.895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="1265" y="1970.895">false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1200" y="1986.0278"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1200" y="1986.0278">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="1200" y="2001.1606">rowId = helper.lastInsertRowID()</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="271" x="1407" y="2001.1606">-- retrieve rowId of the newly inserted row</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="1200" y="2016.2935">listener.rowIdAvailable(rowId)</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="189" x="1388" y="2016.2935">-- publish rowId to the sender</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1200" y="2031.4263">generate Memento using the rowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1200" y="2046.5591"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1200" y="2046.5591">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1249" y="2046.5591"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="1249" y="2046.5591">true</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1184" y="2061.6919">end</text><polygon fill="#FBFB77" filter="url(#f1)" points="813,1908.5,813,1963.8984,1144,1963.8984,1144,1918.5,1134,1908.5,813,1908.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1134" x2="1134" y1="1908.5" y2="1918.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1144" x2="1134" y1="1918.5" y2="1918.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="819" y="1925.5669">These two commands may result in multiple</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="819" y="1940.6997">undo SQL instruction since the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="40" x="1018" y="1940.6997">where</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="1062" y="1940.6997">statement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="819" y="1955.8325">can apply multiple SQL tuples</text><polygon fill="#FBFB77" filter="url(#f1)" points="1252,8.5,1252,517.8828,1759,517.8828,1759,18.5,1749,8.5,1252,8.5" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" points="1252,8.5,1252,517.8828,1402.19,517.8828,1360.43,635.71,1410.19,517.8828,1759,517.8828,1759,18.5,1749,8.5,1252,8.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1749" x2="1749" y1="8.5" y2="18.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1759" x2="1749" y1="18.5" y2="18.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1262" y="25.5669">- commands before the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="73" x="1417" y="25.5669">actualState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1494" y="25.5669">(including it) are all done - able to undo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="1262" y="40.6997">- commands after the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="73" x="1406" y="40.6997">actualState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="1483" y="40.6997">(exluding it) are all undone - able to redo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1262" y="55.8325"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="1258" y="70.9653">resetRedoList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="1360" y="70.9653">() -- clears all items from command's list after actualState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="368" x="1258" y="86.0981">because a new change have been made after some undo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1262" y="101.231"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="1258" y="116.3638">acceptCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1383" y="116.3638">(command):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="131.4966"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="250" x="1274" y="131.4966">-- I store only the undoable commands</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="146.6294"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1274" y="146.6294">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="1288" y="146.6294">(command.undoable)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1290" y="161.7622">resetRedoList()</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="323" x="1391" y="161.7622">-- remove all commands which have been undone</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="1290" y="176.895">commands.add(command)</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="251" x="1469" y="176.895">-- add command to the command's list</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="192.0278"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1274" y="192.0278">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="207.1606"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="438" x="1274" y="207.1606">-- can be called an a background thread too in the commands' order</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1274" y="222.2935">redo()</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1258" y="237.4263">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1262" y="252.5591"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="1258" y="267.6919">undo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="1295" y="267.6919">():</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="282.8247"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1274" y="282.8247">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1288" y="282.8247">(actualState != commands.begin())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1290" y="297.9575">actualState-&gt;undo(helper)</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="257" x="1466" y="297.9575">-- call the last command's undo method</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1290" y="313.0903">actualState-&gt;prev()</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="247" x="1422" y="313.0903">-- go to the previously done command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1290" y="328.2231"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1290" y="328.2231">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1339" y="328.2231"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="1339" y="328.2231">true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="343.356"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1274" y="343.356">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="358.4888"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1274" y="358.4888">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1323" y="358.4888"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="1323" y="358.4888">false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1363" y="358.4888"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="162" x="1363" y="358.4888">-- no undoable command</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1258" y="373.6216">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1262" y="388.7544"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="1258" y="403.8872">redo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="1292" y="403.8872">():</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="419.02"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10" x="1274" y="419.02">if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="1288" y="419.02">(actualState != commands.end())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1290" y="434.1528">actualState-&gt;next()</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="254" x="1422" y="434.1528">-- once the next command was undone</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1290" y="449.2856">actualState-&gt;do(helper)</text><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="168" x="1450" y="449.2856">-- do that command again</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1290" y="464.4185"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1290" y="464.4185">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1339" y="464.4185"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="1339" y="464.4185">true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="479.5513"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1274" y="479.5513">end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="494.6841"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1274" y="494.6841">return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1323" y="494.6841"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="1323" y="494.6841">false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1363" y="494.6841"/><text fill="#808080" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="159" x="1363" y="494.6841">-- no redoable command</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1258" y="509.8169">end</text><path d="M901.194,1151.68 C827.608,1242.848 718.962,1377.454 666.921,1441.929 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="895.814,1147.201,913.822,1136.034,906.708,1155.994,895.814,1147.201" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M988.927,1155.954 C1001.068,1247.007 1018.59,1378.455 1027.06,1441.929 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="981.976,1156.784,986.271,1136.034,995.853,1154.934,981.976,1156.784" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M817.827,1131.081 C794.061,1140.334 769.605,1149.003 746,1156 C600.979,1198.987 538.34,1134.369 411,1216 C333.263,1265.833 279.395,1361.623 251.127,1422.816 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="815.539,1124.457,836.71,1123.555,820.723,1137.462,815.539,1124.457" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1119.99,1147.987 C1148.33,1168.59 1176.76,1191.669 1201,1216 C1271.54,1286.811 1332.86,1388.067 1363.05,1441.947 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1115.59,1153.447,1103.35,1136.152,1123.7,1142.037,1115.59,1153.447" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M507.267,809.46 C486.615,874.22 452.291,981.84 436.466,1031.45 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="500.705,807,513.452,790.07,514.044,811.25,500.705,807" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M541.255,809.46 C562.553,874.22 597.95,981.84 614.269,1031.45 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="534.477,811.26,534.878,790.07,547.776,806.88,534.477,811.26" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M974.22,790.18 C974.502,832.78 975.002,908.36 975.401,968.55 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="975.49,981.92,979.4437,975.8894,975.3977,969.9204,971.444,975.9509,975.49,981.92" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M228,1080.575 C228,1143.616 228,1328.985 228,1422.98 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="228,1075.207,224,1084.207,228,1080.207,232,1084.207,228,1075.207" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="213.0039" y="1095.0117">ins</text><path d="M1333.68,892.9 C1339.81,932.87 1346.16,974.28 1350.97,1005.64 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1353,1018.86,1355.5897,1009.3577,1352.2422,1013.9178,1347.6822,1010.5702,1353,1018.86" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1352.2422" x2="1351.03" y1="1013.9178" y2="1006.01"/><polygon fill="none" points="1331.71,880.02,1328.6656,886.5569,1333.5287,891.8814,1336.5732,885.3444,1331.71,880.02" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1166.02,889.28 C1134.33,917.59 1101.6,946.82 1072.43,972.87 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1062.68,981.58,1072.0581,978.5715,1066.4104,978.2507,1066.7312,972.6029,1062.68,981.58" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1066.4104" x2="1072.37" y1="978.2507" y2="972.925"/><polygon fill="none" points="1175.93,880.43,1168.7901,881.4409,1166.9771,888.4204,1174.117,887.4095,1175.93,880.43" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1146.6752" y="900.2511">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1081.8133" y="970.877">n</text><path d="M1106.1,1136.204 C1122.21,1143.742 1138.73,1150.586 1155,1156 C1328.9,1213.882 1394.87,1143.034 1563,1216 C1576.44,1221.833 1589.8,1228.36 1603,1235.437 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><path d="M1027.63,1516.011 C1017.11,1605.045 990.569,1829.627 981.276,1908.276 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><path d="M664.617,1516.011 C731.051,1605.045 898.628,1829.627 957.313,1908.276 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/></g></svg>